#!/usr/bin/env perl

use strict;
use warnings;

use Test::More;
use REFECO::Blockchain::SmartContracts::Solidity::ABI::Encoder;

my $encoder = REFECO::Blockchain::SmartContracts::Solidity::ABI::Encoder->new();

subtest "https://etherscan.io/tx/0x5f38348937b9fedd3e2463c47eb6575c8f9189cbbbec70e4eec66fabdac7394f" => sub {
    $encoder->append(
        '(address,uint256,uint256,address,address,address,uint256,uint256,uint8,uint256,uint256,bytes32,uint256,bytes32,bytes32,uint256,(uint256,address)[],bytes)'
            => [
            '0x0000000000000000000000000000000000000000',
            0,
            2850000000000000,
            '0x5E9988B0C47B47A5b1d7D2E65358789044C2eF9a',
            '0x004C00500000aD104D7DBd00e3ae0A5C00560C00',
            '0x2Cc8342d7c8BFf5A213eb2cdE39DE9a59b3461A7',
            45981, 1, 2,
            1664873641,
            1667544153,
            '0x0000000000000000000000000000000000000000000000000000000000000000',
            '24446860302761739304752683030156737591518664810215442929812187193154675427388',
            '0x0000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f0000',
            '0x0000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f0000',
            3,
            [
                [75000000000000, '0x0000a26b00c1F0DF003000390027140000fAa719'],
                [30000000000000, '0x2Dc05E282a6829c66e91b655F91129800Fb9DBDF'],
                [45000000000000, '0x2a1De3F4582BB617225e32922Ba789693156FC8C']
            ],
            '0xd410c95bb9d3f04cb0c2340a5fa890e506c2d9159aadd8bf06bcd03e56a9f48c44115a13a2f9fc6184cfe40747ebff2da100329aa385fa19de112ed2f3ed11731b'
            ]);

    my $encoded_doc =
        '000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a200f559c20000000000000000000000000005e9988b0c47b47a5b1d7d2e65358789044c2ef9a000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c000000000000000000000000002cc8342d7c8bff5a213eb2cde39de9a59b3461a7000000000000000000000000000000000000000000000000000000000000b39d0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000633bf4a9000000000000000000000000000000000000000000000000000000006364b4590000000000000000000000000000000000000000000000000000000000000000360c6ebe0000000000000000000000000000000000000000a3d2067fd6a0483c0000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f00000000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f00000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000044364c5bb0000000000000000000000000000000a26b00c1f0df003000390027140000faa71900000000000000000000000000000000000000000000000000001b48eb57e0000000000000000000000000002dc05e282a6829c66e91b655f91129800fb9dbdf000000000000000000000000000000000000000000000000000028ed6103d0000000000000000000000000002a1de3f4582bb617225e32922ba789693156fc8c0000000000000000000000000000000000000000000000000000000000000041d410c95bb9d3f04cb0c2340a5fa890e506c2d9159aadd8bf06bcd03e56a9f48c44115a13a2f9fc6184cfe40747ebff2da100329aa385fa19de112ed2f3ed11731b00000000000000000000000000000000000000000000000000000000000000';

    is(lc $encoder->encode(), lc $encoded_doc);

};

done_testing;

